# =============================================================================
# Nginx Security Hardening Snippet
# Include this in every server block: include /etc/nginx/snippets/security-hardening.conf;
# Maintained at: https://github.com/trumb/nginx-security-baseline
# =============================================================================

# --- Security Headers ---
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;

# --- Server Identity ---
server_tokens off;
autoindex off;

# --- Block dotfiles (.git, .env, .htaccess, etc.) ---
location ~ /\. {
    deny all;
    return 404;
}

# --- Block script extensions that shouldn't exist on static/app servers ---
location ~* \.(php|asp|aspx|jsp|cgi)$ {
    deny all;
    return 404;
}

# --- Block sensitive config/source files ---
location ~* (docker-compose\.ya?ml|Dockerfile|Makefile|\.vscode|sftp\.json|environment\.(test|prod|dev)\.(ts|js)|wp-config\.php|web\.config|\.DS_Store)$ {
    deny all;
    return 404;
}

# --- Block common exploit/scanner paths ---
location ~* ^/(shell|console|actuator|geoserver|portal|owa|SDK|wp-admin|wp-login|wordpress|wp-includes|xmlrpc\.php|wp-json|administrator|phpmyadmin|myadmin|pma|adminer|solr|manager|jmx-console|invoker|status|server-status|server-info|_ignition|telescope|debug|graphql|api-docs|swagger) {
    return 404;
}
